# Verify-only config to test embedded lua-resty-upstream-healthcheck module
# This config is NOT shipped with the release - it's only for build verification

error_log stderr notice;
pid /tmp/nginx.pid;

events {
}

http {
    # Required shared dict for healthcheck module
    lua_shared_dict healthcheck 1m;

    # Require the embedded module and log a marker
    init_by_lua_block {
        local candidates = {
            "resty.upstream.healthcheck",
            "resty_upstream_healthcheck",
            "resty_upstream_healthcheck.lua",
        }

        local hc
        local last_err
        for _, name in ipairs(candidates) do
            local ok, mod = pcall(require, name)
            if ok then
                hc = mod
                package.preload["resty.upstream.healthcheck"] = package.preload[name] or package.preload["resty.upstream.healthcheck"]
                break
            end
            last_err = mod
        end

        if not hc then
            error(last_err)
        end

        ngx.log(ngx.ALERT, "healthcheck module loaded")
    }
}
