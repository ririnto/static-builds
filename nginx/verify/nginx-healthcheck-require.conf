# Verify-only config to test embedded lua-resty-upstream-healthcheck module
# This config is NOT shipped with the release - it's only for build verification

error_log stderr notice;
pid /tmp/nginx.pid;

events {
}

http {
    # Required shared dict for healthcheck module
    lua_shared_dict healthcheck 1m;

    # Require the embedded module and log a marker
    init_by_lua_block {
        local ok, hc = pcall(require, "resty.upstream.healthcheck")
        if not ok then
            local ok_alt, hc_alt = pcall(require, "resty_upstream_healthcheck")
            if not ok_alt then
                error(hc)
            end

            hc = hc_alt
            local preload = package.preload["resty_upstream_healthcheck"]
            if preload then
                package.preload["resty.upstream.healthcheck"] = preload
            end
        end

        ngx.log(ngx.ALERT, "healthcheck module loaded")
    }
}
